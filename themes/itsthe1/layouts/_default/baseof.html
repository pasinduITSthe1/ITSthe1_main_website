<!DOCTYPE html>
<html lang="{{ site.Language.Lang | default "en-US" }}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    
    <!-- SEO Meta Tags -->
    <title>{{ if .Title }}{{ .Title }} | {{ end }}{{ site.Title }}</title>
    <meta name="description" content="{{ if .Description }}{{ .Description }}{{ else }}{{ site.Params.description }}{{ end }}">
    <meta name="keywords" content="{{ site.Params.keywords }}">
    <meta name="author" content="{{ site.Params.author }}">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="{{ .Permalink }}">
    <meta property="og:title" content="{{ if .Title }}{{ .Title }} | {{ end }}{{ site.Title }}">
    <meta property="og:description" content="{{ if .Description }}{{ .Description }}{{ else }}{{ site.Params.description }}{{ end }}">
    
    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="{{ .Permalink }}">
    <meta property="twitter:title" content="{{ if .Title }}{{ .Title }} | {{ end }}{{ site.Title }}">
    <meta property="twitter:description" content="{{ if .Description }}{{ .Description }}{{ else }}{{ site.Params.description }}{{ end }}">
    
    <!-- Favicon and Icons -->
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="192x192" href="/favicon-192x192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="/favicon-512x512.png">
    <link rel="manifest" href="/site.webmanifest">
    
    <!-- Preconnect to external domains -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://cdnjs.cloudflare.com">
    
    <!-- Critical CSS inline -->
    {{ $css := resources.Get "css/style.css" }}
    {{ if $css }}
        {{ $css = $css | minify | fingerprint }}
        <link rel="preload" href="{{ $css.RelPermalink }}" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="{{ $css.RelPermalink }}"></noscript>
    {{ else }}
        <link rel="stylesheet" href="{{ "/css/style.css" | relURL }}">
    {{ end }}
    
    <!-- Load fonts efficiently -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet" media="print" onload="this.media='all'">
    <noscript><link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet"></noscript>
    
    <!-- Font Awesome - load asynchronously -->
    <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"></noscript>
    
    <!-- Custom CSS Variables -->
    <style>
        :root {
            --primary-color: {{ site.Params.primaryColor | default "#FF6B35" }};
            --secondary-color: {{ site.Params.secondaryColor | default "#2C3E50" }};
            --accent-color: {{ site.Params.accentColor | default "#F39C12" }};
            --background-color: {{ site.Params.backgroundColor | default "#FFFFFF" }};
            --text-color: {{ site.Params.textColor | default "#333333" }};
        }
    </style>
</head>
<body>
    {{ partial "header.html" . }}
    
    <main id="main" role="main">
        {{ block "main" . }}{{ end }}
    </main>
    
    {{ partial "footer.html" . }}
    
    <!-- JavaScript - load async -->
    {{ $js := resources.Get "js/main.js" }}
    {{ if $js }}
        {{ $js = $js | minify | fingerprint }}
        <script src="{{ $js.RelPermalink }}" async></script>
    {{ else }}
        <script src="{{ "/js/main.js" | relURL }}" async></script>
    {{ end }}
    
    <!-- Scroll to top button -->
    <button id="scrollToTop" class="scroll-to-top" aria-label="Scroll to top" title="Back to top">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M7 14L12 9L17 14" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
    </button>

    <!-- Enhanced Scroll to Top Script -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const scrollToTopBtn = document.getElementById('scrollToTop');
            
            if (scrollToTopBtn) {
                // Show/hide button based on scroll position
                let ticking = false;
                
                function updateScrollButton() {
                    if (window.pageYOffset > 300) {
                        scrollToTopBtn.classList.add('visible');
                    } else {
                        scrollToTopBtn.classList.remove('visible');
                    }
                    ticking = false;
                }
                
                window.addEventListener('scroll', function() {
                    if (!ticking) {
                        requestAnimationFrame(updateScrollButton);
                        ticking = true;
                    }
                });
                
                // Enhanced click handler with multiple fallbacks
                scrollToTopBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    
                    // Try modern smooth scroll first
                    if ('scrollBehavior' in document.documentElement.style) {
                        window.scrollTo({
                            top: 0,
                            left: 0,
                            behavior: 'smooth'
                        });
                    } else {
                        // Fallback smooth scroll for older browsers
                        smoothScrollToTop();
                    }
                });
                
                // Custom smooth scroll function
                function smoothScrollToTop() {
                    const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
                    if (scrollTop > 0) {
                        window.requestAnimationFrame(smoothScrollToTop);
                        window.scrollTo(0, scrollTop - scrollTop / 8);
                    }
                }
            }
        });
    </script>
</body>
</html>
